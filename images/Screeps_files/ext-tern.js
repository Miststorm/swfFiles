ace.define("ace/snippets",["require","exports","module","ace/lib/oop","ace/lib/event_emitter","ace/lib/lang","ace/range","ace/anchor","ace/keyboard/hash_handler","ace/tokenizer","ace/lib/dom","ace/editor"],function(e,t,n){"use strict";var o=e("./lib/oop"),r=e("./lib/event_emitter").EventEmitter,i=e("./lib/lang"),s=e("./range").Range,a=e("./anchor").Anchor,c=e("./keyboard/hash_handler").HashHandler,l=e("./tokenizer").Tokenizer,p=s.comparePoints,u=function(){this.snippetMap={},this.snippetNameMap={}};(function(){o.implement(this,r),this.getTokenizer=function(){function e(e,t,n){return e=e.substr(1),/^\d+$/.test(e)&&!n.inFormatString?[{tabstopId:parseInt(e,10)}]:[{text:e}]}function t(e){return"(?:[^\\\\"+e+"]|\\\\.)"}return u.$tokenizer=new l({start:[{regex:/:/,onMatch:function(e,t,n){return n.length&&n[0].expectIf?(n[0].expectIf=!1,n[0].elseBranch=n[0],[n[0]]):":"}},{regex:/\\./,onMatch:function(e,t,n){var o=e[1];return"}"==o&&n.length?e=o:-1!="`$\\".indexOf(o)?e=o:n.inFormatString&&("n"==o?e="\n":"t"==o?e="\n":-1!="ulULE".indexOf(o)&&(e={changeCase:o,local:o>"a"})),[e]}},{regex:/}/,onMatch:function(e,t,n){return[n.length?n.shift():e]}},{regex:/\$(?:\d+|\w+)/,onMatch:e},{regex:/\$\{[\dA-Z_a-z]+/,onMatch:function(t,n,o){var r=e(t.substr(1),0,o);return o.unshift(r[0]),r},next:"snippetVar"},{regex:/\n/,token:"newline",merge:!1}],snippetVar:[{regex:"\\|"+t("\\|")+"*\\|",onMatch:function(e,t,n){n[0].choices=e.slice(1,-1).split(",")},next:"start"},{regex:"/("+t("/")+"+)/(?:("+t("/")+"*)/)(\\w*):?",onMatch:function(e,t,n){var o=n[0];return o.fmtString=e,e=this.splitRegex.exec(e),o.guard=e[1],o.fmt=e[2],o.flag=e[3],""},next:"start"},{regex:"`"+t("`")+"*`",onMatch:function(e,t,n){return n[0].code=e.splice(1,-1),""},next:"start"},{regex:"\\?",onMatch:function(e,t,n){n[0]&&(n[0].expectIf=!0)},next:"start"},{regex:"([^:}\\\\]|\\\\.)*:?",token:"",next:"start"}],formatString:[{regex:"/("+t("/")+"+)/",token:"regex"},{regex:"",onMatch:function(e,t,n){n.inFormatString=!0},next:"start"}]}),u.prototype.getTokenizer=function(){return u.$tokenizer},u.$tokenizer},this.tokenizeTmSnippet=function(e,t){return this.getTokenizer().getLineTokens(e,t).tokens.map(function(e){return e.value||e})},this.$getDefaultValue=function(e,t){if(/^[A-Z]\d+$/.test(t)){var n=t.substr(1);return(this.variables[t[0]+"__"]||{})[n]}if(/^\d+$/.test(t))return(this.variables.__||{})[t];if(t=t.replace(/^TM_/,""),e){var o=e.session;switch(t){case"CURRENT_WORD":var r=o.getWordRange();case"SELECTION":case"SELECTED_TEXT":return o.getTextRange(r);case"CURRENT_LINE":return o.getLine(e.getCursorPosition().row);case"PREV_LINE":return o.getLine(e.getCursorPosition().row-1);case"LINE_INDEX":return e.getCursorPosition().column;case"LINE_NUMBER":return e.getCursorPosition().row+1;case"SOFT_TABS":return o.getUseSoftTabs()?"YES":"NO";case"TAB_SIZE":return o.getTabSize();case"FILENAME":case"FILEPATH":return"";case"FULLNAME":return"Ace"}}},this.variables={},this.getVariableValue=function(e,t){return this.variables.hasOwnProperty(t)?this.variables[t](e,t)||"":this.$getDefaultValue(e,t)||""},this.tmStrFormat=function(e,t,n){var o=t.flag||"",r=t.guard;r=new RegExp(r,o.replace(/[^gi]/,""));var i=this.tokenizeTmSnippet(t.fmt,"formatString"),s=this,a=e.replace(r,function(){s.variables.__=arguments;for(var e=s.resolveVariables(i,n),t="E",o=0;o<e.length;o++){var r=e[o];if("object"==typeof r)if(e[o]="",r.changeCase&&r.local){var a=e[o+1];a&&"string"==typeof a&&("u"==r.changeCase?e[o]=a[0].toUpperCase():e[o]=a[0].toLowerCase(),e[o+1]=a.substr(1))}else r.changeCase&&(t=r.changeCase);else"U"==t?e[o]=r.toUpperCase():"L"==t&&(e[o]=r.toLowerCase())}return e.join("")});return this.variables.__=null,a},this.resolveVariables=function(e,t){for(var n=[],o=0;o<e.length;o++){var r=e[o];if("string"==typeof r)n.push(r);else{if("object"!=typeof r)continue;if(r.skip)s(r);else{if(r.processed<o)continue;if(r.text){var i=this.getVariableValue(t,r.text);i&&r.fmtString&&(i=this.tmStrFormat(i,r)),r.processed=o,null==r.expectIf?i&&(n.push(i),s(r)):i?r.skip=r.elseBranch:s(r)}else null!=r.tabstopId?n.push(r):null!=r.changeCase&&n.push(r)}}}function s(t){var n=e.indexOf(t,o+1);-1!=n&&(o=n)}return n},this.insertSnippetForSelection=function(e,t){var n=e.getCursorPosition(),o=e.session.getLine(n.row),r=e.session.getTabString(),i=o.match(/^\s*/)[0];n.column<i.length&&(i=i.slice(0,n.column));var s=this.tokenizeTmSnippet(t),a=[];(s=(s=this.resolveVariables(s,e)).map(function(e){return"\n"==e?e+i:"string"==typeof e?e.replace(/\t/g,r):e})).forEach(function(e,t){if("object"==typeof e){var n=e.tabstopId,o=a[n];if(o||((o=a[n]=[]).index=n,o.value=""),-1===o.indexOf(e)){o.push(e);var r=s.indexOf(e,t+1);if(-1!==r){var i=s.slice(t+1,r);i.some(function(e){return"object"==typeof e})&&!o.value?o.value=i:!i.length||o.value&&"string"==typeof o.value||(o.value=i.join(""))}}}}),a.forEach(function(e){e.length=0});var c={};function l(e){for(var t=[],n=0;n<e.length;n++){var o=e[n];if("object"==typeof o){if(c[o.tabstopId])continue;o=t[e.lastIndexOf(o,n-1)]||{tabstopId:o.tabstopId}}t[n]=o}return t}for(var p=0;p<s.length;p++){var u=s[p];if("object"==typeof u){var h=u.tabstopId,f=s.indexOf(u,p+1);if(c[h])c[h]===u&&(c[h]=null);else{var g=a[h],m="string"==typeof g.value?[g.value]:l(g.value);m.unshift(p+1,Math.max(0,f-p)),m.push(u),c[h]=u,s.splice.apply(s,m),-1===g.indexOf(u)&&g.push(u)}}}var v=0,b=0,x="";s.forEach(function(e){"string"==typeof e?("\n"===e[0]?(b=e.length-1,v++):b+=e.length,x+=e):e.start?e.end={row:v,column:b}:e.start={row:v,column:b}});var y=e.getSelectionRange(),w=e.session.replace(y,x),T=new d(e),C=e.inVirtualSelectionMode&&e.selection.index;T.addTabstops(a,y.start,w,C)},this.insertSnippet=function(e,t){var n=this;if(e.inVirtualSelectionMode)return n.insertSnippetForSelection(e,t);e.forEachSelection(function(){n.insertSnippetForSelection(e,t)},null,{keepOrder:!0}),e.tabstopManager&&e.tabstopManager.tabNext()},this.$getScope=function(e){var t=e.session.$mode.$id||"";if("html"===(t=t.split("/").pop())||"php"===t){"php"!==t||e.session.$mode.inlinePhp||(t="html");var n=e.getCursorPosition(),o=e.session.getState(n.row);"object"==typeof o&&(o=o[0]),o.substring&&("js-"==o.substring(0,3)?t="javascript":"css-"==o.substring(0,4)?t="css":"php-"==o.substring(0,4)&&(t="php"))}return t},this.getActiveScopes=function(e){var t=this.$getScope(e),n=[t],o=this.snippetMap;return o[t]&&o[t].includeScopes&&n.push.apply(n,o[t].includeScopes),n.push("_"),n},this.expandWithTab=function(e,t){var n=this,o=e.forEachSelection(function(){return n.expandSnippetForSelection(e,t)},null,{keepOrder:!0});return o&&e.tabstopManager&&e.tabstopManager.tabNext(),o},this.expandSnippetForSelection=function(e,t){var n,o=e.getCursorPosition(),r=e.session.getLine(o.row),i=r.substring(0,o.column),s=r.substr(o.column),a=this.snippetMap;return this.getActiveScopes(e).some(function(e){var t=a[e];return t&&(n=this.findMatchingSnippet(t,i,s)),!!n},this),!!n&&(!(!t||!t.dryRun)||(e.session.doc.removeInLine(o.row,o.column-n.replaceBefore.length,o.column+n.replaceAfter.length),this.variables.M__=n.matchBefore,this.variables.T__=n.matchAfter,this.insertSnippetForSelection(e,n.content),this.variables.M__=this.variables.T__=null,!0))},this.findMatchingSnippet=function(e,t,n){for(var o=e.length;o--;){var r=e[o];if((!r.startRe||r.startRe.test(t))&&((!r.endRe||r.endRe.test(n))&&(r.startRe||r.endRe)))return r.matchBefore=r.startRe?r.startRe.exec(t):[""],r.matchAfter=r.endRe?r.endRe.exec(n):[""],r.replaceBefore=r.triggerRe?r.triggerRe.exec(t)[0]:"",r.replaceAfter=r.endTriggerRe?r.endTriggerRe.exec(n)[0]:"",r}},this.snippetMap={},this.snippetNameMap={},this.register=function(e,t){var n=this.snippetMap,o=this.snippetNameMap,r=this;function s(e){return e&&!/^\^?\(.*\)\$?$|^\\b$/.test(e)&&(e="(?:"+e+")"),e||""}function a(e,t,n){return e=s(e),t=s(t),n?(e=t+e)&&"$"!=e[e.length-1]&&(e+="$"):(e+=t)&&"^"!=e[0]&&(e="^"+e),new RegExp(e)}function c(e){e.scope||(e.scope=t||"_"),t=e.scope,n[t]||(n[t]=[],o[t]={});var s=o[t];if(e.name){var c=s[e.name];c&&r.unregister(c),s[e.name]=e}n[t].push(e),e.tabTrigger&&!e.trigger&&(!e.guard&&/^\w/.test(e.tabTrigger)&&(e.guard="\\b"),e.trigger=i.escapeRegExp(e.tabTrigger)),e.startRe=a(e.trigger,e.guard,!0),e.triggerRe=new RegExp(e.trigger,"",!0),e.endRe=a(e.endTrigger,e.endGuard,!0),e.endTriggerRe=new RegExp(e.endTrigger,"",!0)}e||(e=[]),e&&e.content?c(e):Array.isArray(e)&&e.forEach(c),this._signal("registerSnippets",{scope:t})},this.unregister=function(e,t){var n=this.snippetMap,o=this.snippetNameMap;function r(e){var r=o[e.scope||t];if(r&&r[e.name]){delete r[e.name];var i=n[e.scope||t],s=i&&i.indexOf(e);s>=0&&i.splice(s,1)}}e.content?r(e):Array.isArray(e)&&e.forEach(r)},this.parseSnippetFile=function(e){e=e.replace(/\r/g,"");for(var t,n=[],o={},r=/^#.*|^({[\s\S]*})\s*$|^(\S+) (.*)$|^((?:\n*\t.*)+)/gm;t=r.exec(e);){if(t[1])try{o=JSON.parse(t[1]),n.push(o)}catch(e){}if(t[4])o.content=t[4].replace(/^\t/gm,""),n.push(o),o={};else{var i=t[2],s=t[3];if("regex"==i){var a=/\/((?:[^\/\\]|\\.)*)|$/g;o.guard=a.exec(s)[1],o.trigger=a.exec(s)[1],o.endTrigger=a.exec(s)[1],o.endGuard=a.exec(s)[1]}else"snippet"==i?(o.tabTrigger=s.match(/^\S*/)[0],o.name||(o.name=s)):o[i]=s}}return n},this.getSnippetByName=function(e,t){var n,o=this.snippetNameMap;return this.getActiveScopes(t).some(function(t){var r=o[t];return r&&(n=r[e]),!!n},this),n}}).call(u.prototype);var d=function(e){if(e.tabstopManager)return e.tabstopManager;e.tabstopManager=this,this.$onChange=this.onChange.bind(this),this.$onChangeSelection=i.delayedCall(this.onChangeSelection.bind(this)).schedule,this.$onChangeSession=this.onChangeSession.bind(this),this.$onAfterExec=this.onAfterExec.bind(this),this.attach(e)};(function(){this.attach=function(e){this.index=0,this.ranges=[],this.tabstops=[],this.$openTabstops=null,this.selectedTabstop=null,this.editor=e,this.editor.on("change",this.$onChange),this.editor.on("changeSelection",this.$onChangeSelection),this.editor.on("changeSession",this.$onChangeSession),this.editor.commands.on("afterExec",this.$onAfterExec),this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler)},this.detach=function(){this.tabstops.forEach(this.removeTabstopMarkers,this),this.ranges=null,this.tabstops=null,this.selectedTabstop=null,this.editor.removeListener("change",this.$onChange),this.editor.removeListener("changeSelection",this.$onChangeSelection),this.editor.removeListener("changeSession",this.$onChangeSession),this.editor.commands.removeListener("afterExec",this.$onAfterExec),this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler),this.editor.tabstopManager=null,this.editor=null},this.onChange=function(e){var t=e.data.range,n="r"==e.data.action[0],o=t.start,r=t.end,i=o.row,s=r.row-i,a=r.column-o.column;if(n&&(s=-s,a=-a),!this.$inChange&&n){var c=this.selectedTabstop;if(c&&!c.some(function(e){return p(e.start,o)<=0&&p(e.end,r)>=0}))return this.detach()}for(var l=this.ranges,u=0;u<l.length;u++){var d=l[u];d.end.row<o.row||(n&&p(o,d.start)<0&&p(r,d.end)>0?(this.removeRange(d),u--):(d.start.row==i&&d.start.column>o.column&&(d.start.column+=a),d.end.row==i&&d.end.column>=o.column&&(d.end.column+=a),d.start.row>=i&&(d.start.row+=s),d.end.row>=i&&(d.end.row+=s),p(d.start,d.end)>0&&this.removeRange(d)))}l.length||this.detach()},this.updateLinkedFields=function(){var e=this.selectedTabstop;if(e&&e.hasLinkedRanges){this.$inChange=!0;for(var n=this.editor.session,o=n.getTextRange(e.firstNonLinked),r=e.length;r--;){var i=e[r];if(i.linked){var s=t.snippetManager.tmStrFormat(o,i.original);n.replace(i,s)}}this.$inChange=!1}},this.onAfterExec=function(e){e.command&&!e.command.readOnly&&this.updateLinkedFields()},this.onChangeSelection=function(){if(this.editor){for(var e=this.editor.selection.lead,t=this.editor.selection.anchor,n=this.editor.selection.isEmpty(),o=this.ranges.length;o--;)if(!this.ranges[o].linked){var r=this.ranges[o].contains(e.row,e.column),i=n||this.ranges[o].contains(t.row,t.column);if(r&&i)return}this.detach()}},this.onChangeSession=function(){this.detach()},this.tabNext=function(e){var t=this.tabstops.length,n=this.index+(e||1);(n=Math.min(Math.max(n,1),t))==t&&(n=0),this.selectTabstop(n),0===n&&this.detach()},this.selectTabstop=function(e){this.$openTabstops=null;var t=this.tabstops[this.index];if(t&&this.addTabstopMarkers(t),this.index=e,(t=this.tabstops[this.index])&&t.length){if(this.selectedTabstop=t,this.editor.inVirtualSelectionMode)this.editor.selection.setRange(t.firstNonLinked);else{var n=this.editor.multiSelect;n.toSingleRange(t.firstNonLinked.clone());for(var o=t.length;o--;)t.hasLinkedRanges&&t[o].linked||n.addRange(t[o].clone(),!0);n.ranges[0]&&n.addRange(n.ranges[0].clone())}this.editor.keyBinding.addKeyboardHandler(this.keyboardHandler)}},this.addTabstops=function(e,t,n){if(this.$openTabstops||(this.$openTabstops=[]),!e[0]){var o=s.fromPoints(n,n);g(o.start,t),g(o.end,t),e[0]=[o],e[0].index=0}var r=[this.index+1,0],i=this.ranges;e.forEach(function(e,n){for(var o=this.$openTabstops[n]||e,a=e.length;a--;){var c=e[a],l=s.fromPoints(c.start,c.end||c.start);f(l.start,t),f(l.end,t),l.original=c,l.tabstop=o,i.push(l),o!=e?o.unshift(l):o[a]=l,c.fmtString?(l.linked=!0,o.hasLinkedRanges=!0):o.firstNonLinked||(o.firstNonLinked=l)}o.firstNonLinked||(o.hasLinkedRanges=!1),o===e&&(r.push(o),this.$openTabstops[n]=o),this.addTabstopMarkers(o)},this),r.length>2&&(this.tabstops.length&&r.push(r.splice(2,1)[0]),this.tabstops.splice.apply(this.tabstops,r))},this.addTabstopMarkers=function(e){var t=this.editor.session;e.forEach(function(e){e.markerId||(e.markerId=t.addMarker(e,"ace_snippet-marker","text"))})},this.removeTabstopMarkers=function(e){var t=this.editor.session;e.forEach(function(e){t.removeMarker(e.markerId),e.markerId=null})},this.removeRange=function(e){var t=e.tabstop.indexOf(e);e.tabstop.splice(t,1),t=this.ranges.indexOf(e),this.ranges.splice(t,1),this.editor.session.removeMarker(e.markerId),e.tabstop.length||(-1!=(t=this.tabstops.indexOf(e.tabstop))&&this.tabstops.splice(t,1),this.tabstops.length||this.detach())},this.keyboardHandler=new c,this.keyboardHandler.bindKeys({Tab:function(e){t.snippetManager&&t.snippetManager.expandWithTab(e)||e.tabstopManager.tabNext(1)},"Shift-Tab":function(e){e.tabstopManager.tabNext(-1)},Esc:function(e){e.tabstopManager.detach()},Return:function(e){return!1}})}).call(d.prototype);var h={};h.onChange=a.prototype.onChange,h.setPosition=function(e,t){this.pos.row=e,this.pos.column=t},h.update=function(e,t,n){this.$insertRight=n,this.pos=e,this.onChange(t)};var f=function(e,t){0==e.row&&(e.column+=t.column),e.row+=t.row},g=function(e,t){e.row==t.row&&(e.column-=t.column),e.row-=t.row};e("./lib/dom").importCssString(".ace_snippet-marker {    -moz-box-sizing: border-box;    box-sizing: border-box;    background: rgba(194, 193, 208, 0.09);    border: 1px dotted rgba(211, 208, 235, 0.62);    position: absolute;}"),t.snippetManager=new u;var m=e("./editor").Editor;(function(){this.insertSnippet=function(e,n){return t.snippetManager.insertSnippet(this,e,n)},this.expandSnippet=function(e){return t.snippetManager.expandWithTab(this,e)}}).call(m.prototype)}),ace.define("ace/autocomplete/text_completer",["require","exports","module","ace/range"],function(e,t,n){var o=e("../range").Range,r=/[^a-zA-Z_0-9\$\-\u00C0-\u1FFF\u2C00-\uD7FF\w]+/;function i(e,t){var n=function(e,t){return e.getTextRange(o.fromPoints({row:0,column:0},t)).split(r).length-1}(e,t),i=e.getValue().split(r),s=Object.create(null),a=i[n];return i.forEach(function(e,t){if(e&&e!==a){var o=Math.abs(n-t),r=i.length-o;s[e]?s[e]=Math.max(r,s[e]):s[e]=r}}),s}t.getCompletions=function(e,t,n,o,r){var s=i(t,n);r(null,Object.keys(s).map(function(e){return{caption:e,value:e,score:s[e],meta:"local"}}))}}),ace.define("ace/autocomplete/popup",["require","exports","module","ace/edit_session","ace/virtual_renderer","ace/editor","ace/range","ace/lib/event","ace/lib/lang","ace/lib/dom"],function(e,t,n){"use strict";e("../edit_session").EditSession;var o=e("../virtual_renderer").VirtualRenderer,r=e("../editor").Editor,i=e("../range").Range,s=e("../lib/event"),a=e("../lib/lang"),c=e("../lib/dom");c.importCssString(".ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {    background-color: #CAD6FA;    z-index: 1;}.ace_editor.ace_autocomplete .ace_line-hover {    border: 1px solid #abbffe;    margin-top: -1px;    background: rgba(233,233,253,0.4);}.ace_editor.ace_autocomplete .ace_line-hover {    position: absolute;    z-index: 2;}.ace_editor.ace_autocomplete .ace_scroller {   background: none;   border: none;   box-shadow: none;}.ace_rightAlignedText {    color: gray;    display: inline-block;    position: absolute;    right: 4px;    text-align: right;    z-index: -1;}.ace_editor.ace_autocomplete .ace_completion-highlight{    color: #000;    text-shadow: 0 0 0.01em;}.ace_editor.ace_autocomplete {    width: 280px;    z-index: 200000;    background: #fbfbfb;    color: #444;    border: 1px lightgray solid;    position: fixed;    box-shadow: 2px 3px 5px rgba(0,0,0,.2);    line-height: 1.4;}"),t.AcePopup=function(e){var t=c.createElement("div"),n=new function(e){var t=new o(e);t.$maxLines=4;var n=new r(t);return n.setHighlightActiveLine(!1),n.setShowPrintMargin(!1),n.renderer.setShowGutter(!1),n.renderer.setHighlightGutterLine(!1),n.$mouseHandler.$focusWaitTimout=0,n.$highlightTagPending=!0,n}(t);e&&e.appendChild(t),t.style.display="none",n.renderer.content.style.cursor="default",n.renderer.setStyle("ace_autocomplete"),n.setOption("displayIndentGuides",!1),n.setOption("dragDelay",150);var l,p=function(){};n.focus=p,n.$isFocused=!0,n.renderer.$cursorLayer.restartTimer=p,n.renderer.$cursorLayer.element.style.opacity=0,n.renderer.$maxLines=8,n.renderer.$keepTextAreaAtCursor=!1,n.setHighlightActiveLine(!1),n.session.highlight(""),n.session.$searchHighlight.clazz="ace_highlight-marker",n.on("mousedown",function(e){var t=e.getDocumentPosition();n.selection.moveToPosition(t),d.start.row=d.end.row=t.row,e.stop()});var u=new i(-1,0,-1,1/0),d=new i(-1,0,-1,1/0);d.id=n.session.addMarker(d,"ace_active-line","fullLine"),n.setSelectOnHover=function(e){e?u.id&&(n.session.removeMarker(u.id),u.id=null):u.id=n.session.addMarker(u,"ace_line-hover","fullLine")},n.setSelectOnHover(!1),n.on("mousemove",function(e){if(l){if(l.x!=e.x||l.y!=e.y){(l=e).scrollTop=n.renderer.scrollTop;var t=l.getDocumentPosition().row;u.start.row!=t&&(u.id||n.setRow(t),f(t))}}else l=e}),n.renderer.on("beforeRender",function(){if(l&&-1!=u.start.row){l.$pos=null;var e=l.getDocumentPosition().row;u.id||n.setRow(e),f(e,!0)}}),n.renderer.on("afterRender",function(){var e=n.getRow(),t=n.renderer.$textLayer,o=t.element.childNodes[e-t.config.firstRow];o!=t.selectedNode&&(t.selectedNode&&c.removeCssClass(t.selectedNode,"ace_selected"),t.selectedNode=o,o&&c.addCssClass(o,"ace_selected"))});var h=function(){f(-1)},f=function(e,t){e!==u.start.row&&(u.start.row=u.end.row=e,t||n.session._emit("changeBackMarker"),n._emit("changeHoverMarker"))};n.getHoveredRow=function(){return u.start.row},s.addListener(n.container,"mouseout",h),n.on("hide",h),n.on("changeSelection",h),n.session.doc.getLength=function(){return n.data.length},n.session.doc.getLine=function(e){var t=n.data[e];return"string"==typeof t?t:t&&t.value||""};var g=n.session.bgTokenizer;return g.$tokenizeRow=function(e){var t=n.data[e],o=[];if(!t)return o;"string"==typeof t&&(t={value:t}),t.caption||(t.caption=t.value||t.name);var r,i,s=-1;t.iconClass&&o.push({type:t.iconClass,value:" "});for(var a=0;a<t.caption.length;a++)i=t.caption[a],s!==(r=t.matchMask&1<<a?1:0)?(o.push({type:t.className||(r?"completion-highlight":""),value:i}),s=r):o[o.length-1].value+=i;if(t.meta){var c=n.renderer.$size.scrollerWidth/n.renderer.layerConfig.characterWidth,l=t.meta;l.length+t.caption.length>c-2&&(l=l.substr(0,c-t.caption.length-3)+"…"),o.push({type:"rightAlignedText",value:l})}return o},g.$updateOnChange=p,g.start=p,n.session.$computeWidth=function(){return this.screenWidth=0},n.$blockScrolling=1/0,n.isOpen=!1,n.isTopdown=!1,n.data=[],n.setData=function(e){n.data=e||[],n.setValue(a.stringRepeat("\n",e.length),-1),n.setRow(0)},n.getData=function(e){return n.data[e]},n.getRow=function(){return d.start.row},n.setRow=function(e){e=Math.max(-1,Math.min(this.data.length,e)),d.start.row!=e&&(n.selection.clearSelection(),d.start.row=d.end.row=e||0,n.session._emit("changeBackMarker"),n.moveCursorTo(e||0,0),n.isOpen&&n._signal("select"))},n.on("changeSelection",function(){n.isOpen&&n.setRow(n.selection.lead.row),n.renderer.scrollCursorIntoView()}),n.hide=function(){this.container.style.display="none",this._signal("hide"),n.isOpen=!1},n.show=function(e,t,o){var r=this.container,i=window.innerHeight,s=window.innerWidth,a=this.renderer.$maxLines*t*1.4,c=e.top+this.$borderSize;c+a>i-t&&!o?(r.style.top="",r.style.bottom=i-c+"px",n.isTopdown=!1):(c+=t,r.style.top=c+"px",r.style.bottom="",n.isTopdown=!0),r.style.display="",this.renderer.$textLayer.checkForSizeChanges();var p=e.left;p+r.offsetWidth>s&&(p=s-r.offsetWidth),r.style.left=p+"px",this._signal("show"),l=null,n.isOpen=!0},n.getTextLeftOffset=function(){return this.$borderSize+this.renderer.$padding+this.$imageSize},n.$imageSize=0,n.$borderSize=1,n}}),ace.define("ace/autocomplete/util",["require","exports","module"],function(e,t,n){"use strict";t.parForEach=function(e,t,n){var o=0,r=e.length;0===r&&n();for(var i=0;i<r;i++)t(e[i],function(e,t){++o===r&&n(e,t)})};var o=/[a-zA-Z_0-9\$\-\u00A2-\uFFFF]/;t.retrievePrecedingIdentifier=function(e,t,n){n=n||o;for(var r=[],i=t-1;i>=0&&n.test(e[i]);i--)r.push(e[i]);return r.reverse().join("")},t.retrieveFollowingIdentifier=function(e,t,n){n=n||o;for(var r=[],i=t;i<e.length&&n.test(e[i]);i++)r.push(e[i]);return r}}),ace.define("ace/autocomplete",["require","exports","module","ace/keyboard/hash_handler","ace/autocomplete/popup","ace/autocomplete/util","ace/lib/event","ace/lib/lang","ace/lib/dom","ace/snippets"],function(e,t,n){"use strict";var o=e("./keyboard/hash_handler").HashHandler,r=e("./autocomplete/popup").AcePopup,i=e("./autocomplete/util"),s=(e("./lib/event"),e("./lib/lang")),a=e("./lib/dom"),c=e("./snippets").snippetManager,l=function(){this.autoInsert=!1,this.autoSelect=!0,this.exactMatch=!1,this.gatherCompletionsId=0,this.keyboardHandler=new o,this.keyboardHandler.bindKeys(this.commands),this.blurListener=this.blurListener.bind(this),this.changeListener=this.changeListener.bind(this),this.mousedownListener=this.mousedownListener.bind(this),this.mousewheelListener=this.mousewheelListener.bind(this),this.changeTimer=s.delayedCall(function(){this.updateCompletions(!0)}.bind(this)),this.tooltipTimer=s.delayedCall(this.updateDocTooltip.bind(this),50)};(function(){this.$init=function(){return this.popup=new r(document.body||document.documentElement),this.popup.on("click",function(e){this.insertMatch(),e.stop()}.bind(this)),this.popup.focus=this.editor.focus.bind(this.editor),this.popup.on("show",this.tooltipTimer.bind(null,null)),this.popup.on("select",this.tooltipTimer.bind(null,null)),this.popup.on("changeHoverMarker",this.tooltipTimer.bind(null,null)),this.popup},this.getPopup=function(){return this.popup||this.$init()},this.openPopup=function(e,t,n){this.popup||this.$init(),this.popup.setData(this.completions.filtered),e.keyBinding.addKeyboardHandler(this.keyboardHandler);var o=e.renderer;if(this.popup.setRow(this.autoSelect?0:-1),n)n&&!t&&this.detach();else{this.popup.setTheme(e.getTheme()),this.popup.setFontSize(e.getFontSize());var r=o.layerConfig.lineHeight,i=o.$cursorLayer.getPixelPosition(this.base,!0);i.left-=this.popup.getTextLeftOffset();var s=e.container.getBoundingClientRect();i.top+=s.top-o.layerConfig.offset,i.left+=s.left-e.renderer.scrollLeft,i.left+=o.$gutterLayer.gutterWidth,this.popup.show(i,r)}},this.detach=function(){this.editor.keyBinding.removeKeyboardHandler(this.keyboardHandler),this.editor.off("changeSelection",this.changeListener),this.editor.off("blur",this.blurListener),this.editor.off("mousedown",this.mousedownListener),this.editor.off("mousewheel",this.mousewheelListener),this.changeTimer.cancel(),this.hideDocTooltip(),this.gatherCompletionsId+=1,this.popup&&this.popup.isOpen&&this.popup.hide(),this.base&&this.base.detach(),this.activated=!1,this.completions=this.base=null},this.changeListener=function(e){var t=this.editor.selection.lead;(t.row!=this.base.row||t.column<this.base.column)&&this.detach(),this.activated?this.changeTimer.schedule():this.detach()},this.blurListener=function(e){var t=document.activeElement,n=this.editor.textInput.getElement();t==n||this.popup&&t.parentNode==this.popup.container||t==this.tooltipNode||e.relatedTarget==this.tooltipNode||e.relatedTarget==n||this.detach()},this.mousedownListener=function(e){this.detach()},this.mousewheelListener=function(e){this.detach()},this.goTo=function(e){var t=this.popup.getRow(),n=this.popup.session.getLength()-1;switch(e){case"up":t=t<=0?n:t-1;break;case"down":t=t>=n?-1:t+1;break;case"start":t=0;break;case"end":t=n}this.popup.setRow(t)},this.insertMatch=function(e){if(e||(e=this.popup.getData(this.popup.getRow())),!e)return!1;if(e.completer&&e.completer.insertMatch)e.completer.insertMatch(this.editor,e);else{if(this.completions.filterText)for(var t,n=this.editor.selection.getAllRanges(),o=0;t=n[o];o++)t.start.column-=this.completions.filterText.length,this.editor.session.remove(t);e.snippet?c.insertSnippet(this.editor,e.snippet):this.editor.execCommand("insertstring",e.value||e)}this.detach()},this.commands={Up:function(e){e.completer.goTo("up")},Down:function(e){e.completer.goTo("down")},"Ctrl-Up|Ctrl-Home":function(e){e.completer.goTo("start")},"Ctrl-Down|Ctrl-End":function(e){e.completer.goTo("end")},Esc:function(e){e.completer.detach()},Return:function(e){return e.completer.insertMatch()},"Shift-Return":function(e){e.completer.insertMatch(!0)},Tab:function(e){var t=e.completer.insertMatch();if(t||e.tabstopManager)return t;e.completer.goTo("down")},PageUp:function(e){e.completer.popup.gotoPageUp()},PageDown:function(e){e.completer.popup.gotoPageDown()}},this.gatherCompletions=function(e,t){var n=e.getSession(),o=e.getCursorPosition(),r=n.getLine(o.row),s=i.retrievePrecedingIdentifier(r,o.column);this.base=n.doc.createAnchor(o.row,o.column-s.length),this.base.$insertRight=!0;var a=[],c=e.completers.length;return e.completers.forEach(function(r,l){r.getCompletions(e,n,o,s,function(o,r){o||(a=a.concat(r));var s=e.getCursorPosition(),l=n.getLine(s.row);t(null,{prefix:i.retrievePrecedingIdentifier(l,s.column,r[0]&&r[0].identifierRegex),matches:a,finished:0==--c})})}),!0},this.showPopup=function(e){this.editor&&this.detach(),this.activated=!0,this.editor=e,e.completer!=this&&(e.completer&&e.completer.detach(),e.completer=this),e.on("changeSelection",this.changeListener),e.on("blur",this.blurListener),e.on("mousedown",this.mousedownListener),e.on("mousewheel",this.mousewheelListener),this.updateCompletions()},this.updateCompletions=function(e){if(e&&this.base&&this.completions){var t=this.editor.getCursorPosition(),n=this.editor.session.getTextRange({start:this.base,end:t});if(n==this.completions.filterText)return;return this.completions.setFilter(n),this.completions.filtered.length?1!=this.completions.filtered.length||this.completions.filtered[0].value!=n||this.completions.filtered[0].snippet?void this.openPopup(this.editor,n,e):this.detach():this.detach()}var o=this.gatherCompletionsId;this.gatherCompletions(this.editor,function(t,n){var r=function(){if(n.finished)return this.detach()}.bind(this),i=n.prefix,s=n&&n.matches;if(!s||!s.length)return r();if(0===i.indexOf(n.prefix)&&o==this.gatherCompletionsId){this.completions=new p(s),this.exactMatch&&(this.completions.exactMatch=!0),this.completions.setFilter(i);var a=this.completions.filtered;return a.length&&(1!=a.length||a[0].value!=i||a[0].snippet)?this.autoInsert&&1==a.length&&n.finished?this.insertMatch(a[0]):void this.openPopup(this.editor,i,e):r()}}.bind(this))},this.cancelContextMenu=function(){this.editor.$mouseHandler.cancelContextMenu()},this.updateDocTooltip=function(){var e=this.popup,t=e.data,n=t&&(t[e.getHoveredRow()]||t[e.getRow()]),o=null;return n&&this.editor&&this.popup.isOpen?(this.editor.completers.some(function(e){return e.getDocTooltip&&(o=e.getDocTooltip(n)),o}),o||(o=n),"string"==typeof o&&(o={docText:o}),o&&(o.docHTML||o.docText)?void this.showDocTooltip(o):this.hideDocTooltip()):this.hideDocTooltip()},this.showDocTooltip=function(e){this.tooltipNode||(this.tooltipNode=a.createElement("div"),this.tooltipNode.className="ace_tooltip ace_doc-tooltip",this.tooltipNode.style.margin=0,this.tooltipNode.style.pointerEvents="auto",this.tooltipNode.tabIndex=-1,this.tooltipNode.onblur=this.blurListener.bind(this));var t=this.tooltipNode;e.docHTML?t.innerHTML=e.docHTML:e.docText&&(t.textContent=e.docText),t.parentNode||document.body.appendChild(t);var n=this.popup,o=n.container.getBoundingClientRect();t.style.top=n.container.style.top,t.style.bottom=n.container.style.bottom,window.innerWidth-o.right<320?(t.style.right=window.innerWidth-o.left+"px",t.style.left=""):(t.style.left=o.right+1+"px",t.style.right=""),t.style.display="block"},this.hideDocTooltip=function(){if(this.tooltipTimer.cancel(),this.tooltipNode){var e=this.tooltipNode;this.editor.isFocused()||document.activeElement!=e||this.editor.focus(),this.tooltipNode=null,e.parentNode&&e.parentNode.removeChild(e)}}}).call(l.prototype),l.startCommand={name:"startAutocomplete",exec:function(e){e.completer||(e.completer=new l),e.completer.autoInsert=!1,e.completer.autoSelect=!0,e.completer.showPopup(e),e.completer.cancelContextMenu()},bindKey:"Ctrl-Space|Ctrl-Shift-Space|Alt-Space"};var p=function(e,t,n){this.all=e,this.filtered=e,this.filterText=t||"",this.exactMatch=!1};(function(){this.setFilter=function(e){if(e.length>this.filterText&&0===e.lastIndexOf(this.filterText,0))var t=this.filtered;else t=this.all;this.filterText=e;var n=null;t=(t=(t=this.filterCompletions(t,this.filterText)).sort(function(e,t){return t.exactMatch-e.exactMatch||t.score-e.score})).filter(function(e){var t=e.snippet||e.caption||e.value;return t!==n&&(n=t,!0)}),this.filtered=t},this.filterCompletions=function(e,t){var n=[],o=t.toUpperCase(),r=t.toLowerCase();e:for(var i,s=0;i=e[s];s++){var a=i.value||i.caption||i.snippet;if(a){var c,l,p=-1,u=0,d=0;if(this.exactMatch){if(t!==a.substr(0,t.length))continue e}else for(var h=0;h<t.length;h++){var f=a.indexOf(r[h],p+1),g=a.indexOf(o[h],p+1);if((c=f>=0&&(g<0||f<g)?f:g)<0)continue e;(l=c-p-1)>0&&(-1===p&&(d+=10),d+=l),u|=1<<c,p=c}i.matchMask=u,i.exactMatch=d?0:1,i.score=(i.score||0)-d,n.push(i)}}return n}}).call(p.prototype),t.Autocomplete=l,t.FilteredList=p}),ace.define("ace/tern/tern_server",["require","exports","module","ace/range","ace/lib/dom"],function(require,exports,module){"use strict";var TernServer=function(options){var self=this;this.options=options||{};var plugins=this.options.plugins||(this.options.plugins={});if(plugins.hasOwnProperty("doc_comment")||(plugins.doc_comment={}),plugins.doc_comment.hasOwnProperty("fullDocs")||(plugins.doc_comment.fullDocs=!0),this.options.hasOwnProperty("switchToDoc")||(this.options.switchToDoc=function(e,t){}),this.options.hasOwnProperty("defs")||(this.options.defs=["browser","ecma5","screeps"]),this.options.hasOwnProperty("useWorker")||(this.options.useWorker=!0),this.options.useWorker)this.server=new WorkerServer(this,this.options.workerClass);else{if(this.options.defs&&this.options.defs.length>0){for(var tmp=[],i=0;i<this.options.defs.length;i++)tmp.push(eval("def_"+this.options.defs[i]));this.options.defs=tmp}this.server=new tern.Server({getFile:function(e,t){return getFile(self,e,t)},async:!0,defs:this.options.defs,plugins:this.options.plugins})}this.docs=Object.create(null),this.trackChange=function(e,t){trackChange(self,t,e)},this.cachedArgHints=null,this.activeArgHints=null,this.jumpStack=[],this.aceTextCompletor=null,this.lastAutoCompleteFireTime=null,this.queryTimeout=3e3,this.options.queryTimeout&&!isNaN(parseInt(this.options.queryTimeout))&&(this.queryTimeout=parseInt(this.options.queryTimeout))},Pos=function(e,t){return{line:e,ch:t}},cls="Ace-Tern-",bigDoc=250,aceCommands={ternJumpToDef:{name:"ternJumpToDef",exec:function(e){e.ternServer.jumpToDef(e)},bindKey:"Alt-."},ternJumpBack:{name:"ternJumpBack",exec:function(e){e.ternServer.jumpBack(e)},bindKey:"Alt-,"},ternShowType:{name:"ternShowType",exec:function(e){e.ternServer.showType(e)},bindKey:"Ctrl-I"},ternFindRefs:{name:"ternFindRefs",exec:function(e){e.ternServer.findRefs(e)},bindKey:"Ctrl-E"},ternRename:{name:"ternRename",exec:function(e){e.ternServer.rename(e)},bindKey:"Ctrl-Shift-E"},ternRefresh:{name:"ternRefresh",exec:function(e){var t=!1;null!=e.ternServer.refreshDocLastCalled&&(new Date).getTime()-e.ternServer.refreshDocLastCalled<1e3&&(t=!0),e.ternServer.refreshDocLastCalled=(new Date).getTime(),e.ternServer.refreshDoc(e,t)},bindKey:"Alt-R"}},debugCompletions=!1;function resolveFilePath(e,t,n){e.options.resolveFilePath?e.options.resolveFilePath(t,n):n(t)}function getFile(e,t,n){var o=e.docs[t];o?n(docValue(e,o)):e.options.getFile?e.options.getFile(t,n):n(null)}function findDoc(e,t,n){for(var o in e.docs){var r=e.docs[o];if(r.doc==t)return r}if(!n)for(var i=0;;++i)if(o="[doc"+(i||"")+"]",!e.docs[o]){n=o;break}return e.addDoc(n,t)}function toTernLoc(e){return void 0!==e.row?{line:e.row,ch:e.column}:e}function toAceLoc(e){return e.line?{row:e.line,column:e.ch}:e}function buildRequest(e,t,n,o,r){var i=[],s=0,a=!n.fullDocs;if(a||delete n.fullDocs,"string"==typeof n&&(n={type:n}),n.lineCharPositions=!0,null==n.end){var c=t.doc.getSelectionRange();n.end=toTernLoc(o||c.end),c.start!=c.end&&(n.start=toTernLoc(c.start))}var l=n.start||n.end;if(t.changed)if(!r&&t.doc.session.getLength()>bigDoc&&!1!==a&&t.changed.to-t.changed.from<100&&t.changed.from<=l.line&&t.changed.to>n.end.line){i.push(getFragmentAround(t,l,n.end)),n.file="#0";s=i[0].offsetLines;null!=n.start&&(n.start=Pos(n.start.line- -s,n.start.ch)),n.end=Pos(n.end.line-s,n.end.ch)}else i.push({type:"full",name:t.name,text:docValue(e,t)}),n.file=t.name,t.changed=null;else n.file=t.name;for(var p in e.docs){var u=e.docs[p];u.changed&&u!=t&&(i.push({type:"full",name:u.name,text:docValue(e,u)}),u.changed=null)}return{query:n,files:i,timeout:e.queryTimeout}}function getFragmentAround(e,t,n){for(var o,r=e.doc,i=null,s=null,a=r.session.$tabSize,c=t.line-1,l=Math.max(0,c-50);c>=l;--c){var p=r.session.getLine(c);if(!(p.search(/\bfunction\b/)<0)){var u=countColumn(p,null,a);null!=i&&i<=u||(i=u,s=c)}}null==s&&(s=l);var d=Math.min(r.session.getLength()-1,n.line+20);if(null==i||i==countColumn(r.session.getLine(t.line),null,a))o=d;else for(o=n.line+1;o<d;++o){if((u=countColumn(r.session.getLine(o),null,a))<=i)break}var h=Pos(s,0);return{type:"part",name:e.name,offsetLines:h.line,text:r.session.getTextRange({start:toAceLoc(h),end:toAceLoc(Pos(o,0))})}}function countColumn(e,t,n,o,r){null==t&&-1==(t=e.search(/[^\s\u00a0]/))&&(t=e.length);for(var i=o||0,s=r||0;i<t;++i)"\t"==e.charAt(i)?s+=n-s%n:++s;return s}function docValue(e,t){var n=t.doc.getValue();return e.options.fileFilter&&(n=e.options.fileFilter(n,t.name,t.doc)),n}function typeToIcon(e){var t;return t="?"==e?"unknown":"number"==e||"string"==e||"bool"==e?e:/^fn\(/.test(e)?"fn":/^\[/.test(e)?"array":"object",cls+"completion "+cls+"completion-"+t}TernServer.prototype={bindAceKeys:function(e){for(var t in aceCommands){var n=aceCommands[t];e.commands.addCommand(n)}},addDoc:function(e,t){var n={doc:t,name:e,changed:null},o="";return"String"===t.constructor.name?o=t:(o=docValue(this,n),t.on("change",this.trackChange)),this.server.addFile(e,o),this.docs[e]=n},delDoc:function(e){var t=this.docs[e];if(t){try{t.doc.off("change",this.trackChange)}catch(e){}delete this.docs[e],this.server.delFile(e)}},hideDoc:function(e){closeAllTips();var t=this.docs[e];t&&t.changed&&sendDoc(this,t)},refreshDoc:function(e,t){var n=function(t){var n=document.createElement("span");n.setAttribute("style","color:green;"),n.innerHTML=t,tempTooltip(e,n,2e3)};if(t)return this.docChanged(e),void n("Tern fully refreshed (reloaded current doc and all refs)");sendDoc(this,findDoc(this,e)),n('Tern document refreshed <div style="color:gray; font-size:smaller;">(press hotkey twice in  &lt; 1 second to do a full reload including refs)</div>')},getCompletions:function(e,t,n,o,r){getCompletions(this,e,t,n,o,r)},showType:function(e,t,n){showType(this,e,t,n)},updateArgHints:function(e){updateArgHints(this,e)},jumpToDef:function(e){jumpToDef(this,e)},jumpBack:function(e){jumpBack(this,e)},rename:function(e){rename(this,e)},findRefs:function(e){findRefs(this,e)},request:function(e,t,n,o,r){var i=this,s=findDoc(this,e),a=buildRequest(this,s,t,o,r);this.server.request(a,function(e,o){!e&&i.options.responseFilter&&(o=i.options.responseFilter(s,t,a,e,o)),n(e,o)})},enabledAtCurrentLocation:function(e){return inJavascriptMode(e)},getCallPos:function(e,t){return getCallPos(e,t)},docChanged:function(e){var t=this;for(var n in this.docs)this.delDoc(n);var o=function(n){t.addDoc(n,e),loadExplicitVsRefs(t,e)};this.options.getCurrentFileName?this.options.getCurrentFileName(o):o("current")},restart:function(){this.options.useWorker&&this.server.restart(this)},debug:function(e){e&&this.options.useWorker&&this.server.sendDebug(e)},debugCompletions:function(e){debugCompletions=!!e}},exports.TernServer=TernServer;var popupSelectBound=!1;function getCompletions(e,t,n,o,r,i){var s=function(){try{var t=e.lastAutoCompleteFireTime;if(!t)return!1;if((new Date).getTime()-t<1e3)return!0}catch(e){showError({msg:"autoCompleteFiredTwiceInThreshold",err:e})}return!1}();if(!s){var a=getCurrentToken(t);a&&a.type&&-1!==a.type.indexOf("comment")&&(s=!0)}debugCompletions&&Math.random().toString(36).slice(2),e.request(t,{type:"completions",types:!0,origins:!0,docs:!0,filter:!1,omitObjectPrototype:!1,sort:!1,includeKeywords:!0,guess:!0,expandWordForward:!0},function(a,c){if(a)return showError(e,t,a);var l=c.completions.map(function(e){return{iconClass:" "+(e.guess?cls+"guess":typeToIcon(e.type)),doc:e.doc,type:e.type,caption:e.name,value:e.name,score:99999,meta:e.origin?e.origin.replace(/^.*[\\\/]/,""):"tern"}}),p=[];if(!0===t.getOption("enableBasicAutocompletion"))try{p=t.session.$mode.getCompletions()}catch(e){}if((s||0===l.length)&&e.aceTextCompletor){var u=[];try{e.aceTextCompletor.getCompletions(t,n,o,r,function(e,t){u=t.map(function(e){return{doc:e.doc,type:e.type,caption:e.caption,value:e.value,meta:"localText"}});for(var n=function(e,t){if((e=e.toLowerCase().trim()).length<2)return!0;for(var n=!1,o=0;o<p.length;o++)if(p[o].value.toString().toLowerCase()==e){n=!0;break}return n},o=0;o<u.length;o++){var r=u[o];n(r.value)||p.push(r)}})}catch(n){showError(e,t,{msg:"ace text completor error",err:n})}}if(p.length>0){for(var d=l.slice(),h=0;h<p.length;h++){for(var f=p[h],g=!1,m=0;m<l.length;m++)if(l[m].value.toString()===f.value.toString()){g=!0;break}g||d.push(f)}l=d.slice()}i(null,l);function v(){closeAllTips();var e=t.completer.popup.getData(t.completer.popup.getRow());if(e&&e.doc){var n=t.completer.popup.renderer.getContainerElement();makeTooltip(n.getBoundingClientRect().right+window.pageXOffset,n.getBoundingClientRect().top+window.pageYOffset,createInfoDataTip(e,!0),t).className+=" "+cls+"hint-doc"}}(function e(){if(t.popupSelectBound)return!1;if(!t.completer.popup)return void setTimeout(e,100);t.completer.popup.on("select",v);t.completer.popup.on("hide",function(){closeAllTips()});v();t.popupSelectBound=!0})()||v();try{e.lastAutoCompleteFireTime=(new Date).getTime()}catch(n){showError(e,t,{msg:"error with last autoCompleteFireTime ",err:n})}})}function showType(e,t,n,o){if(o){if(t.completer&&t.completer.popup&&t.completer.popup.isOpen)return;if(!isOnFunctionCall(t))return}else if(!inJavascriptMode(t))return;var r=function(i,s,a){var c="";if(i){if(o)return;return showError(e,t,i)}if(e.options.typeTip)c=e.options.typeTip(s);else{if(o){if(s.hasOwnProperty("guess")&&!0===s.guess)return;if("?"==s.type||"string"==s.type||"number"==s.type||"bool"==s.type||"date"==s.type||"fn(document: ?)"==s.type||"fn()"==s.type)return}if(s.hasOwnProperty("type")){if("?"==s.type)return void(c=tempTooltip(t,elFromString("<span>?</span>"),1e3));if(s.type.toString().length>1&&"fn"!==s.type.toString().substr(0,2)){return void e.request(t,"definition",function(e,t){r(e,t,s)},n,!1,null)}}else a&&a.hasOwnProperty("type")&&(s.type=a.type,s.name=a.name,s.exprName=a.exprName)}c=createInfoDataTip(s,!0),setTimeout(function(){var e=getCusorPosForTooltip(t);makeTooltip(e.left,e.top,c,t,!0)},10)};e.request(t,"type",r,n,!o)}function createInfoDataTip(e,t,n){var o=elt("span",null),r=e.doc,i=e.params||parseJsDocParams(r);if(t){var s=e.fnArgs?e.fnArgs:e.type?parseFnType(e.type):null;if(s){var a=function(e,t){if(null===i)return null;if(!e.name)return null;for(var n=[],o=0;o<i.length;o++)if(!0===t)i[o].parentName.toLowerCase().trim()===e.name.toLowerCase().trim()&&n.push(i[o]);else if(i[o].name.toLowerCase().trim()===e.name.toLowerCase().trim())return i[o];return!0===t?n:null},c=function(e){var t=e.name;return!0===e.optional&&(t=e.defaultValue?"["+t+"="+e.defaultValue+"]":"["+t+"]"),t},l=0===i.length||!isNaN(parseInt(n)),p="";p+=htmlEncode(e.exprName||e.name||"fn"),p+="(";for(var u=null,d=[],h=0;h<s.args.length;h++){var f="",g=!isNaN(parseInt(n))&&h===n,m=s.args[h],v=m.name||"?";if(v.length>1&&"?"===v.substr(v.length-1)&&(v=v.substr(0,v.length-1),m.name=v),l){var b=a(m,!1),x=a(m,!0),y=m.type,w=!1,T="";if(null!==b&&(v=b.name,b.type&&(y=b.type),g&&(u=b),w=b.optional,T=b.defaultValue.trim()),x&&x.length>0){g&&(d=x),y="{";for(var C=0;C<x.length;C++)y+=x[C].name,C+1!==x.length&&x.length>1&&(y+=", ");y+="}"}f+=y?'<span class="'+cls+'type">'+htmlEncode(y)+"</span> ":"",f+='<span class="'+cls+(g?"farg-current":"farg")+'">'+(htmlEncode(v)||"?")+"</span>",""!==T&&(f+='<span class="'+cls+'jsdoc-param-defaultValue">='+htmlEncode(T)+"</span>"),w&&(f='<span class="'+cls+'jsdoc-param-optionalWrapper"><span class="'+cls+'farg-optionalBracket">[</span>'+f+'<span class="'+cls+'jsdoc-param-optionalBracket">]</span></span>')}else f+=htmlEncode(v);h>0&&(f=", "+f),p+=f}if(p+=")",s.rettype){for(var S=s.rettype,k=S.replace(/^\[+/g,"").replace(/\]+$/g,"");"["==S.charAt(0)&&"]"==S.charAt(S.length-1);)k+="[]",S=S.substring(1,S.length-1);p+=l?' -> <span class="'+cls+'type">'+htmlEncode(k)+"</span>":" -> "+htmlEncode(k)}if(p='<span class="'+cls+(l?"typeHeader":"typeHeader-simple")+'">'+p+"</span>",l&&(u&&u.description&&(p+='<div class="'+cls+'farg-current-description"><span class="'+cls+'farg-current-name">'+u.name+": </span>"+u.description+"</div>"),d&&d.length>0))for(h=0;h<d.length;h++){var A=d[h].type?'<span class="'+cls+'type">{'+d[h].type+"} </span>":"";p+='<div class="'+cls+'farg-current-description">'+A+'<span class="'+cls+'farg-current-name">'+c(d[h])+": </span>"+d[h].description+"</div>"}o.appendChild(elFromString(p))}}if(isNaN(parseInt(n))){if(e.doc){"*"===r.substr(0,1)&&(r=r.substr(1)),r=function(e){try{for(var t,n=/\bhttps?:\/\/[^\s<>"`{}|\^\[\]\\]+/gi;null!==(t=n.exec(e));){t.index===n.lastIndex&&n.lastIndex++;var o=t[0].replace(/https/i,"HTTPS_PROTO_PLACEHOLDER").replace(/http/i,"HTTP_PROTO_PLACEHOLDER"),r=t[0].replace(new RegExp("https://","i"),"").replace(new RegExp("http://","i"),"");e=e.replace(t[0],'<a class="'+cls+'tooltip-link" href="'+o+'" target="_blank">'+r+" </a>")}e=e.replace(new RegExp("HTTPS_PROTO_PLACEHOLDER","gi"),"https").replace(new RegExp("HTTP_PROTO_PLACEHOLDER","gi"),"http")}catch(e){showError(ts,editor,e)}return e}(r=function(e){e=" "+e+" ";try{for(var t,n=/\s{[^}]{1,50}}\s/g;null!==(t=n.exec(e));)t.index===n.lastIndex&&n.lastIndex++,e=e.replace(t[0],' <span class="'+cls+'type">'+t[0].trim()+"</span> ")}catch(e){showError(ts,editor,e)}return e.trim()}(r=function(e){try{e=" "+e+" ";for(var t,n=/ ?@\w{1,50}\s ?/gi;null!==(t=n.exec(e));)t.index===n.lastIndex&&n.lastIndex++,e=e.replace(t[0],' <span class="'+cls+'jsdoc-tag">'+t[0].trim()+"</span> ")}catch(e){showError(ts,editor,e)}return e.trim()}(r=function(e,t){if(0===t.length)return e;for(var n=(e=e.replace(/@param/gi,"@param")).substr(0,e.indexOf("@param"));-1!==e.indexOf("@param");)e=e.substring(e.indexOf("@param")+6);e=-1!==e.indexOf("@")?e.substr(e.indexOf("@")):"";for(var o="",r=0;r<t.length;r++){if(o+="<div>",""===t[r].parentName.trim()?o+=' <span class="'+cls+'jsdoc-tag">@param</span> ':o+='<span class="'+cls+'jsdoc-tag-param-child">&nbsp;</span> ',o+=""===t[r].type.trim()?"":'<span class="'+cls+'type">{'+t[r].type+"}</span> ",""!==t[r].name.trim()){var i=t[r].name.trim();""!==t[r].parentName.trim()&&(i=t[r].parentName.trim()+"."+i);var s='<span class="'+cls+'jsdoc-param-name">'+i+"</span>";""!==t[r].defaultValue.trim()&&(s+='<span class="'+cls+'jsdoc-param-defaultValue">='+t[r].defaultValue+"</span>"),t[r].optional&&(s='<span class="'+cls+'jsdoc-param-optionalWrapper"><span class="'+cls+'farg-optionalBracket">[</span>'+s+'<span class="'+cls+'jsdoc-param-optionalBracket">]</span></span>'),o+=s}o+=""===t[r].description.trim()?"":' - <span class="'+cls+'jsdoc-param-description">'+t[r].description+"</span>",o+="</div>"}return""!==o&&(e='<span class="'+cls+'jsdoc-param-wrapper">'+o+"</span>"+e),n+e}(r=htmlEncode(r.trim()),i)))),o.appendChild(elFromString(r))}if(e.url){o.appendChild(document.createTextNode(" "));var L=elt("a",null,"[docs]");L.target="_blank",L.href=e.url,o.appendChild(L)}e.origin&&o.appendChild(elt("div",null,elt("em",null,"source: "+e.origin)))}return o}function parseJsDocParams(e){if(!e)return[];e=e.replace(/@param/gi,"@param");for(var t=[];-1!==e.indexOf("@param");){for(var n,o=(e=e.substring(e.indexOf("@param")+6)).indexOf("@"),r=-1===o?e:e.substr(0,o),i={name:"",parentName:"",type:"",description:"",optional:!1,defaultValue:""},s=/\s{[^}]{1,50}}\s/;null!==(n=s.exec(r));)n.index===s.lastIndex&&s.lastIndex++,i.type=n[0],r=r.replace(i.type,"").trim(),i.type=i.type.replace("{","").replace("}","").replace(" ","").trim();if("["===(r=r.trim()).substr(0,1)){i.optional=!0;var a=r.indexOf("]");if(-1===a){showError("failed to parse parameter name; Found starting '[' but missing closing ']'");continue}var c=r.substring(0,a+1);if(r=r.replace(c,"").trim(),-1!==(c=c.replace("[","").replace("]","")).indexOf("=")){var l=c.substr(c.indexOf("=")+1);""===l.trim()?i.defaultValue="undefined":i.defaultValue=l.trim(),i.name=c.substring(0,c.indexOf("=")).trim()}else i.name=c.trim()}else{var p=r.indexOf(" ");-1!==p?(i.name=r.substr(0,p),r=r.substr(p).trim()):(i.name=r,r="")}var u=i.name.indexOf(".");-1!==u&&(i.parentName=i.name.substring(0,u),i.name=i.name.substring(u+1)),(r=r.trim()).length>0&&(i.description=r.replace("-","").trim()),i.name=htmlEncode(i.name),i.parentName=htmlEncode(i.parentName),i.description=htmlEncode(i.description),i.type=htmlEncode(i.type),i.defaultValue=htmlEncode(i.defaultValue),t.push(i)}return t}function findRefs(e,t,n){inJavascriptMode(t)&&e.request(t,{type:"refs",fullDocs:!0},function(o,r){if(o)return showError(e,t,o);if("function"!=typeof n){closeAllTips();var i=document.createElement("div"),s=document.createElement("span");s.textContent=r.name+"("+r.type+")",s.setAttribute("style","font-weight:bold;"),i.appendChild(s);var a=makeTooltip(null,null,i,t,!1,-1);if(r.refs&&0!==r.refs.length){var c=document.createElement("div");c.setAttribute("style","font-style:italic; margin-bottom:3px; cursor:help"),c.innerHTML=r.refs.length+" References Found",c.setAttribute("title","Use up and down arrow keys to navigate between references. \n\nPress Esc while focused on the list to close the popup (or use the close button in the top right corner).\n\n This is not guaranteed to find references in other files or references for non-private variables."),i.appendChild(c);var l=document.createElement("select");l.setAttribute("multiple","multiple"),l.addEventListener("change",function(){for(var n,o=findDoc(e,t),r=0;r<this.options.length;r++)n?this[r].selected=!1:this[r].selected&&((n=this[r]).style.color="grey");var i=n.getAttribute("data-file"),s={line:n.getAttribute("data-line"),ch:n.getAttribute("data-ch")},c=300,l={name:i};o.name==i&&(l=o,c=50);var p=t.getAnimatedScroll();p&&t.setAnimatedScroll(!1),moveTo(e,o,l,s,null,!0),setTimeout(function(){moveTooltip(a,null,null,t),closeAllTips(a),p&&t.setAnimatedScroll(!0)},c)});for(var p=function(e,t){var n=document.createElement("option");n.setAttribute("data-file",e),n.setAttribute("data-line",t.line),n.setAttribute("data-ch",t.ch),n.text=t.line+1+":"+t.ch+" - "+e,l.appendChild(n)},u=function(){var e=15*l.options.length;e=e>175?175:e,l.style.height=e+"px",a.appendChild(l),l.focus(),l.addEventListener("keydown",function(e){e&&e.keyCode&&27==e.keyCode&&remove(a)})},d=0;d<r.refs.length;d++){var h=r.refs[d];try{p(h.file,h.start),d===r.refs.length-1&&u()}catch(e){}}}else a.appendChild(elt("div","","No References Found"))}else n(r)})}function rename(e,t){findRefs(e,t,function(n){if(n&&0!==n.refs.length){var o=makeTooltip(null,null,elt("div","",n.name+": "+n.refs.length+" references found \n (WARNING: this wont work for refs in another file!) \n\n Enter new name:\n"),t,!0),r=elt("input");o.appendChild(r);try{setTimeout(function(){r.focus()},100)}catch(e){}var i=elt("button","");i.textContent="Rename",i.setAttribute("type","button"),i.addEventListener("click",function(){remove(o);var i=r.value;i&&0!==i.trim().length?function(o){e.request(t,{type:"rename",newName:o,fullDocs:!0},function(o,r){if(o)return showError(e,t,o);applyChanges(e,r.changes,function(e){var o=makeTooltip(null,null,elt("div","","Replaced "+e.replaced+" references sucessfully"),t,!0),r=elt("div","");r.setAttribute("style","color:red"),e.replaced!=n.refs.length&&(r.textContent=" WARNING! original refs: "+n.refs.length+", replaced refs: "+e.replaced),""!==e.errors&&(r.textContent+=" \n Errors encountered:"+e.errors),""!==r.textContent&&o.appendChild(r)})})}(i):showError(e,t,"new name cannot be empty")}),o.appendChild(i)}else showError(e,t,"Cannot rename as no references were found for this variable")})}var nextChangeOrig=0;function applyChanges(e,t,n){for(var o=ace.require("ace/range").Range,r=Object.create(null),i=0;i<t.length;++i){(r[(p=t[i]).file]||(r[p.file]=[])).push(p)}var s={replaced:0,status:"",errors:""};for(var a in r){var c=e.docs[a],l=r[a];if(c){l.sort(function(e,t){return cmpPos(t.start,e.start)});for(++nextChangeOrig,i=0;i<l.length;++i)try{var p;(p=l[i]).start=toAceLoc(p.start),p.end=toAceLoc(p.end),c.doc.session.replace(new o(p.start.row,p.start.column,p.end.row,p.end.column),p.text),s.replaced++}catch(e){s.errors+="\n "+a+" - "+e.toString()}}}"function"==typeof n&&n(s)}function isOnFunctionCall(e){if(!inJavascriptMode(e))return!1;if(somethingIsSelected(e))return!1;if(isInCall(e))return!1;var t=getCurrentToken(e);if(t&&t.start){if(-1!==t.type.indexOf("entity.name.function"))return!1;if(-1!==t.type.indexOf("storage.type"))return!1;var n=e.session.getTokenAt(e.getSelectionRange().end.row,t.start+t.value.length+1);return!(!n||"("!==n.value)}}function somethingIsSelected(e){return""!==e.getSession().getTextRange(e.getSelectionRange())}function getCusorPosForTooltip(e){var t=e.renderer.$cursorLayer.getPixelPosition();return t.top=e.renderer.$cursorLayer.cursors[0].offsetTop,t.top+=e.renderer.scroller.getBoundingClientRect().top,t.left+=e.renderer.container.offsetLeft,{left:t.left+45,top:t.top+17}}function getCurrentToken(e){try{var t=e.getSelectionRange().end;return e.session.getTokenAt(t.row,t.column)}catch(t){showError(ts,e,t)}}function getCallPos(e,t){if(!somethingIsSelected(e)&&inJavascriptMode(e)){for(var n={},o=t||e.getSelectionRange().start,r=(o=toAceLoc(o)).row,i=o.column,s=Math.max(0,r-6),a="",c=0,l=[],p=r;p>=s;p--){var u=e.session.getLine(p);p===r&&(u=u.substr(0,i));for(var d=u.length;d>=0;d--)if("}"===(a=u.substr(d,1))||")"===a||"]"===a)c+=1;else if("{"===a||"("===a||"["===a){if(!(c>0)){if("("===a){var h=u.substr(0,d);if(!h.length){0;break}if(" "===h.substr(h.length-1)){0;break}var f=h.split(" ").reverse()[1];if(f&&"function"===f.toLowerCase()){0;break}var g=e.session.getTokenAt(p,d);if(g&&(-1!==g.type.toString().indexOf("comment")||"keyword"===g.type||"storage.type"===g.type)){0;break}0,n={line:p,ch:d};break}break}c-=1}else","===a&&0===c&&l.push({line:p,ch:d})}if(n.hasOwnProperty("line")){for(var m=0,v=0;v<l.length;v++){var b=l[v];(b.line===n.line&&b.ch>n.ch||b.line>n.line)&&(m+=1)}return{start:toTernLoc(n),argpos:m}}}}function isInCall(e,t){return!!getCallPos(e,t)}var debounce_updateArgHints=null;function updateArgHints(e,t){clearTimeout(debounce_updateArgHints),closeArgHints(e);var n=getCallPos(t);if(n){var o=n.start,r=n.argpos,i=e.cachedArgHints;if(i&&i.doc==t&&0===cmpPos(o,i.start))return showArgHints(e,t,r);debounce_updateArgHints=setTimeout(function(){e.request(t,{type:"type",preferFunction:!0,end:o},function(n,i){if(n&&-1===n.toString().toLowerCase().indexOf("no expression at")&&-1===n.toString().toLowerCase().indexOf("no type found at"))return showError(e,t,n);!n&&i.type&&/^fn\(/.test(i.type)&&(e.cachedArgHints={start:o,type:parseFnType(i.type),name:i.exprName||i.name||"fn",guess:i.guess,doc:t,comments:i.doc},showArgHints(e,t,r))})},500)}}function showArgHints(e,t,n){closeArgHints(e);var o=e.cachedArgHints;o.type,o.comments;if(!o.hasOwnProperty("params"))if(o.comments){var r=parseJsDocParams(o.comments);r&&0!==r.length?o.params=r:o.params=null}else o.params=null;var i=getCusorPosForTooltip(t),s=createInfoDataTip({name:o.name,guess:o.guess,fnArgs:o.type,doc:o.comments,params:o.params},!0,n);e.activeArgHints=makeTooltip(i.left,i.top,s,t,!0)}function parseFnType(e){if("fn"!==e.substring(0,2))return null;if(-1===e.indexOf("("))return null;var t=[],n=3;function o(t){for(var o=0,r=n;;){var i=e.charAt(n);if(t.test(i)&&!o)return e.slice(r,n);/[{\[\(]/.test(i)?++o:/[}\]\)]/.test(i)&&--o,++n}}if(")"!=e.charAt(n))for(;;){var r=e.slice(n).match(/^([^, \(\[\{]+): /);if(r&&(n+=r[0].length,r=r[1]),t.push({name:r,type:o(/[\),]/)}),")"==e.charAt(n))break;n+=2}var i=e.slice(n).match(/^\) -> (.*)$/);return{args:t,rettype:i&&i[1]}}function htmlEncode(e){var t={"<":"&lt;",">":"&gt;"};return String(e).replace(/[<>]/g,function(e){return e?t[e]:""})}function cmpPos(e,t){return e=toTernLoc(e),t=toTernLoc(t),e.line-t.line||e.ch-t.ch}function dialog(e,t,n){alert("need to implment dialog")}function elFromString(e){var t=document.createDocumentFragment(),n=document.createElement("span");for(n.innerHTML=e;n.firstChild;)t.appendChild(n.firstChild);return t}function elt(e,t){var n=document.createElement(e);t&&(n.className=t);for(var o=2;o<arguments.length;++o){var r=arguments[o];"string"==typeof r&&(r=document.createTextNode(r)),n.appendChild(r)}return n}function closeAllTips(e){var t=document.querySelectorAll("."+cls+"tooltip");if(t.length>0)for(var n=0;n<t.length;n++)e&&t[n]==e||remove(t[n])}function tempTooltip(e,t,n){n||(n=3e3);var o=getCusorPosForTooltip(e);return makeTooltip(o.left,o.top,t,e,!0,n)}function makeTooltip(e,t,n,o,r,i){if(null===e||null===t){var s=getCusorPosForTooltip(o);e=s.left,t=s.top}var a=elt("div",cls+"tooltip",n);a.style.left=e+"px",a.style.top=t+"px",document.body.appendChild(a);var c=document.createElement("a");if(c.setAttribute("title","close"),c.setAttribute("class",cls+"tooltip-boxclose"),c.addEventListener("click",function(){remove(a)}),a.appendChild(c),!0===r){if(!o)throw Error("tern.makeTooltip called with closeOnCursorActivity=true but editor was not passed. Need to pass editor!");var l=function(){a.parentNode&&(remove(a),o.getSession().selection.off("changeCursor",l),o.getSession().off("changeScrollTop",l),o.getSession().off("changeScrollLeft",l))};o.getSession().selection.on("changeCursor",l),o.getSession().on("changeScrollTop",l),o.getSession().on("changeScrollLeft",l)}if(i&&(i=parseInt(i,10))>100){setTimeout(function(){if(a.parentNode){fadeOut(a,i);try{o.getSession().selection.off("changeCursor",l),o.getSession().off("changeScrollTop",l),o.getSession().off("changeScrollLeft",l)}catch(e){}}},i)}return a}function moveTooltip(e,t,n,o){if(null===t||null===n){var r=getCusorPosForTooltip(o);t=r.left,n=r.top}e.style.left=t+"px",e.style.top=n+"px"}function remove(e){var t=e&&e.parentNode;t&&t.removeChild(e)}function fadeOut(e,t){t||(t=1100),-1!==t?(e.style.opacity="0",setTimeout(function(){remove(e)},t)):remove(e)}function showError(e,t,n,o){try{var r="",i=function(e){return e&&e.name&&e.stack&&e.message};if(i(n)?(r=n.name+": "+n.message,n.stack):n.msg&&n.err?(r=n.msg,i(n.err)&&(r+=": "+n.err.message,n.err.stack)):(r=n,"details not supplied. current stack:\n"+(new Error).stack),!o){var s=elt("span",null,r);s.style.color="red",tempTooltip(t,s)}}catch(e){setTimeout(function(){throw void 0===typeof r&&(r=" (no error passed)"),new Error("tern show error failed."+r+"\n\n fail error: "+e.name+"\n"+e.message+"\n"+e.stack)},0)}}function closeArgHints(e){e.activeArgHints&&(remove(e.activeArgHints),e.activeArgHints=null)}function jumpToDef(e,t){!function(n){var o={type:"definition",variable:n||null},r=findDoc(e,t);e.server.request(buildRequest(e,r,o,null,!0),function(n,o){if(n)return showError(e,t,n);if(o.file||!o.url){if(o.file){var i,s=e.docs[o.file];return s&&(i=findContext(s.doc,o))?(e.jumpStack.push({file:r.name,start:toTernLoc(t.getSelectionRange().start),end:toTernLoc(t.getSelectionRange().end)}),void moveTo(e,r,s,i.start,i.end)):void moveTo(e,r,{name:o.file},o.start,o.end)}showError(e,t,"Could not find a definition.")}else window.open(o.url)})}()}function moveTo(e,t,n,o,r,i){if(r=r||o,t==n){var s=toAceLoc(o);t.doc.gotoLine(s.row,s.column||0),t.doc.getSession().unfold(s),t.doc.getSession().getSelection().setSelectionRange({start:toAceLoc(o),end:toAceLoc(r)})}else e.options.switchToDoc?(i||closeAllTips(),e.options.switchToDoc(n.name,toAceLoc(o),toAceLoc(r))):showError(e,t.doc,"Need to add editor.ternServer.options.switchToDoc to jump to another document")}function jumpBack(e,t){var n=e.jumpStack.pop(),o=n&&e.docs[n.file];o&&moveTo(e,findDoc(e,t),o,n.start,n.end)}function findContext(e,t){try{var n=t.context.slice(0,t.contextOffset).split("\n"),o=t.start.line-(n.length-1),r=null;r=1==n.length?t.start.ch:e.session.getLine(o).length-n[0].length;for(var i=Pos(o,r),s=e.session.getLine(o).slice(i.ch),a=o+1;a<e.session.getLength()&&s.length<t.context.length;++a)s+="\n"+e.session.getLine(a)}catch(e){}return t}function atInterestingExpression(e){var t=e.getSelectionRange().end,n=e.session.getTokenAt(t.row,t.column);return t=toTernLoc(t),(!(n.start<t.ch)||"comment"!=n.type&&"string"!=n.type)&&/\w/.test(e.session.getLine(t.line).slice(Math.max(t.ch-1,0),t.ch+1))}function sendDoc(e,t){e.server.request({files:[{type:"full",name:t.name,text:docValue(e,t)}]},function(e){e||(t.changed=null)})}function inJavascriptMode(e){return"javascript"==getCurrentMode(e)}function getCurrentMode(e){var t=e.session.$mode.$id||"";if("html"===(t=t.split("/").pop())||"php"===t){"php"===t&&(t="html");var n=e.getCursorPosition(),o=e.session.getState(n.row);"object"==typeof o&&(o=o[0]),o.substring&&("js-"==o.substring(0,3)?t="javascript":"css-"==o.substring(0,4)?t="css":"php-"==o.substring(0,4)&&(t="php"))}return t}function startsWith(e,t){return e.slice(0,t.length).toUpperCase()==t.toUpperCase()}function trackChange(e,t,n){var o={};o.from=toTernLoc(n.data.range.start),o.to=toTernLoc(n.data.range.end),n.data.hasOwnProperty("text")?o.text=[n.data.text]:o.text=n.data.lines;var r=findDoc(e,t),i=e.cachedArgHints;i&&i.doc==t&&cmpPos(i.start,o.to)<=0&&(e.cachedArgHints=null);var s=r.changed;null===s&&(r.changed=s={from:o.from.line,to:o.from.line});var a=o.from.line+(o.text.length-1);o.from.line<s.to&&(s.to=s.to-(o.to.line-a)),a>=s.to&&(s.to=a+1),s.from>o.from.line&&(s.from=s.from.line),t.session.getLength()>bigDoc&&o.to-s.from>100&&setTimeout(function(){r.changed&&r.changed.to-r.changed.from>100&&sendDoc(e,r)},200)}function loadExplicitVsRefs(e,t){if(t.ternServer&&t.ternServer.enabledAtCurrentLocation(t)){for(var n=window&&window.location&&0===window.location.toString().toLowerCase().indexOf("http"),o="",r=0;r<t.session.getLength();r++){var i=t.session.getLine(r);if("///"!==i.substr(0,3))break;o+="\n"+i}if(""!==o){for(var s,a=/(?!\/\/\/\s*?<reference path=")[^"]*/g,c=[];null!=(s=a.exec(o));){s.index===a.lastIndex&&a.lastIndex++;var l=s[0].replace('"',"");-1===l.toLowerCase().indexOf("reference path")&&""!==l.trim()&&-1===l.toLowerCase().indexOf("/>")&&-1===l.toLowerCase().indexOf("vsdoc")&&c.push(l)}var p=document.createElement("span"),u=0,d=0,h=function(e,n){d++;var o=document.createElement("div");o.setAttribute("style","font-size:smaller; font-style:italic; color:"+(n?"red":"gray")),o.textContent=e,p.appendChild(o),u==d&&tempTooltip(t,p)},f=function(o){try{if(0===o.toLowerCase().indexOf("http")||n){u++;var r=new XMLHttpRequest;r.open("get",o,!0),r.send(),r.onreadystatechange=function(){4==r.readyState&&(200==r.status?(h("adding web reference: "+o),t.ternServer.addDoc(o,r.responseText)):404==r.status?h("error adding web reference (not found): "+o,!0):h("error adding web reference (unknown error, see console): "+o,!0))}}else u++,resolveFilePath(e,o,function(t){getFile(e,t,function(n,o){n||!o?h("error getting file: "+t+"(see console for details)",!0):(e.addDoc(t,o.toString()),h("adding reference: "+t))})})}catch(e){throw e}};for(r=0;r<c.length;r++){f(c[r])}}}}function WorkerServer(e,t){var n=t?new t:new Worker(e.options.workerScript),o=function(e){n.postMessage({type:"init",defs:e.options.defs,plugins:e.options.plugins,scripts:e.options.workerDeps})};o(e);var r=0,i={};function s(e,t){t&&(e.id=++r,i[r]=t),n.postMessage(e)}n.onmessage=function(t){var n=t.data;"getFile"==n.type?getFile(e,n.name,function(e,t){s({type:"getFile",err:String(e),text:t,id:n.id})}):"debug"==n.type||n.id&&i[n.id]&&(i[n.id](n.err,n.body),delete i[n.id])},n.onerror=function(e){for(var t in i)i[t](e);i={}},this.addFile=function(e,t){s({type:"add",name:e,text:t})},this.delFile=function(e){s({type:"del",name:e})},this.request=function(e,t){s({type:"req",body:e},t)},this.setDefs=function(e){s({type:"setDefs",defs:e})},this.restart=function(e){o(e)},this.sendDebug=function(e){s({type:"debug",body:e})}}var dom=require("ace/lib/dom");dom.importCssString(".Ace-Tern-tooltip { border: 1px solid silver; border-radius: 3px; color: #444; padding: 2px 5px; padding-right:15px; font-size: 90%; font-family: monospace; background-color: white; white-space: pre-wrap; max-width: 50em; max-height:30em; overflow-y:auto; position: absolute; z-index: 10; -webkit-box-shadow: 2px 3px 5px rgba(0, 0, 0, .2); -moz-box-shadow: 2px 3px 5px rgba(0, 0, 0, .2); box-shadow: 2px 3px 5px rgba(0, 0, 0, .2); transition: opacity 1s; -moz-transition: opacity 1s; -webkit-transition: opacity 1s; -o-transition: opacity 1s; -ms-transition: opacity 1s; } .Ace-Tern-tooltip-boxclose { position:absolute; top:0; right:3px; color:red; } .Ace-Tern-tooltip-boxclose:hover { background-color:yellow; } .Ace-Tern-tooltip-boxclose:before { content:'×'; cursor:pointer; font-weight:bold; font-size:larger; } .Ace-Tern-completion { padding-left: 12px; position: relative; } .Ace-Tern-completion:before { position: absolute; left: 0; bottom: 0; border-radius: 50%; font-weight: bold; height: 13px; width: 13px; font-size:11px; line-height: 14px; text-align: center; color: white; -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; } .Ace-Tern-completion-unknown:before { content:'?'; background: #4bb; } .Ace-Tern-completion-object:before { content:'O'; background: #77c; } .Ace-Tern-completion-fn:before { content:'F'; background: #7c7; } .Ace-Tern-completion-array:before { content:'A'; background: #c66; } .Ace-Tern-completion-number:before { content:'1'; background: #999; } .Ace-Tern-completion-string:before { content:'S'; background: #999; } .Ace-Tern-completion-bool:before { content:'B'; background: #999; } .Ace-Tern-completion-guess { color: #999; } .Ace-Tern-hint-doc { max-width: 35em; } .Ace-Tern-fhint-guess { opacity: .7; } .Ace-Tern-fname { color: black; } .Ace-Tern-farg { color: #70a; } .Ace-Tern-farg-current { color: #70a; font-weight:bold; font-size:larger; text-decoration:underline; } .Ace-Tern-farg-current-description { font-style:italic; margin-top:2px; color:black; } .Ace-Tern-farg-current-name { font-weight:bold; } .Ace-Tern-type { color: #07c; font-size:smaller; } .Ace-Tern-jsdoc-tag { color: #B93A38; text-transform: lowercase; font-size:smaller; font-weight:600; } .Ace-Tern-jsdoc-param-wrapper{ /*background-color: #FFFFE3; padding:3px;*/ } .Ace-Tern-jsdoc-tag-param-child{ display:inline-block; width:0px; } .Ace-Tern-jsdoc-param-optionalWrapper { font-style:italic; } .Ace-Tern-jsdoc-param-optionalBracket { color:grey; font-weight:bold; } .Ace-Tern-jsdoc-param-name { color: #70a; font-weight:bold; } .Ace-Tern-jsdoc-param-defaultValue { color:grey; } .Ace-Tern-jsdoc-param-description { color:black; } .Ace-Tern-typeHeader-simple{ font-size:smaller; font-weight:bold; display:block; font-style:italic; margin-bottom:3px; color:grey; } .Ace-Tern-typeHeader{ display:block; font-style:italic; margin-bottom:3px; } .Ace-Tern-tooltip-link{font-size:smaller; color:blue;} .ace_autocomplete {width: 400px !important;}","ace_tern")}),ace.define("ace/tern/tern",["require","exports","module","ace/config","ace/snippets","ace/autocomplete/text_completer","ace/autocomplete","ace/tern/tern_server","ace/editor"],function(e,t,n){"use strict";var o=e("../config"),r=e("../snippets").snippetManager,i={getCompletions:function(e,t,n,o,i){var s=r.snippetMap,a=[];r.getActiveScopes(e).forEach(function(e){for(var t=s[e]||[],n=t.length;n--;){var o=t[n],r=o.name||o.tabTrigger;r&&a.push({caption:r,snippet:o.content,meta:o.tabTrigger&&!o.name?o.tabTrigger+"⇥ ":"snippet"})}},this),i(null,a)}},s=e("../autocomplete/text_completer"),a={getCompletions:function(e,t,n,o,r){var i=e.session.getState(n.row);r(null,t.$mode.getCompletions(i,t,n,o))}},c=[i,s,a];t.setCompleters=function(e){c=e||[]},t.addCompleter=function(e){c.push(e)};var l={name:"expandSnippet",exec:function(e){r.expandWithTab(e)||e.execCommand("indent")},bindKey:"tab"},p=function(e){var t=e.$id;if(r.files||(r.files={}),u(t),e.$modes)for(var n in e.$modes)p(e.$modes[n])},u=function(e){if(e&&!r.files[e]){var t=e.replace("mode","snippets");r.files[e]={},o.loadModule(t,function(t){t&&(r.files[e]=t,!t.snippets&&t.snippetText&&(t.snippets=r.parseSnippetFile(t.snippetText)),r.register(t.snippets||[],t.scope),t.includeScopes&&(r.snippetMap[t.scope].includeScopes=t.includeScopes,t.includeScopes.forEach(function(e){u("ace/mode/"+e)})))})}};var d=e("../autocomplete").Autocomplete;d.startCommand={name:"startAutocomplete",exec:function(e,t){e.completer||(e.completer=new d),e.completers=[],e.$enableSnippets&&e.completers.push(i),e.ternServer&&e.$enableTern&&e.ternServer.enabledAtCurrentLocation(e)?(e.completers.push(e.ternServer),e.ternServer.aceTextCompletor=s):e.$enableBasicAutocompletion&&e.completers.push(s,a),e.completer.showPopup(e),e.completer.cancelContextMenu()},bindKey:"Ctrl-Space|Ctrl-Shift-Space|Alt-Space"};var h,f,g=function(e,t){p(t.session.$mode)},m={},v=e("./tern_server").TernServer,b=null,x=function(e,t){clearTimeout(f),f=setTimeout(function(){b.ternServer.updateArgHints(b)},10)},y=function(e,t){if("insertstring"===e.command.name&&"."===e.args&&e.editor.ternServer&&e.editor.ternServer.enabledAtCurrentLocation(e.editor)){var n=e.editor.getSelectionRange().end,o=e.editor.session.getTokenAt(n.row,n.column);if(o&&"string"!==o.type&&-1===o.type.toString().indexOf("comment")){try{e.editor.ternServer.lastAutoCompleteFireTime=null}catch(e){}e.editor.execCommand("startAutocomplete")}}};c.push(h),t.server=h;var w=e("../editor").Editor;o.defineOptions(w.prototype,"editor",{enableTern:{set:function(e){var t=this;"object"==typeof e&&(m=e,e=!0),e?(b=t,function(e){var t=m.workerScript||o.moduleUrl("worker/tern");if(!1===m.useWorker){var n="ace_tern_files";if(document.getElementById(n))i();else{var r=document.createElement("script");r.setAttribute("id",n),document.head.appendChild(r),r.onload=i,r.setAttribute("src",t)}}else i();function i(){m.workerScript||(m.workerScript=t),h=new v(m),e()}}(function(){t.completers=c,t.ternServer=h,t.commands.addCommand(d.startCommand),t.getSession().selection.on("changeCursor",x),t.commands.on("afterExec",y),h.bindAceKeys(t),m.startedCb&&m.startedCb()})):(delete t.ternServer,t.getSession().selection.off("changeCursor",x),t.commands.off("afterExec",y),t.enableBasicAutocompletion||t.commands.removeCommand(d.startCommand))},value:!1},enableBasicAutocompletion:{set:function(e){e?(this.completers=c,this.commands.addCommand(d.startCommand)):this.$enableTern||this.commands.removeCommand(d.startCommand)},value:!1},enableSnippets:{set:function(e){e?(this.commands.addCommand(l),this.on("changeMode",g),g(0,this)):(this.commands.removeCommand(l),this.off("changeMode",g))},value:!1}})}),function(){ace.require(["ace/tern/tern"],function(){})}();